<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Filippinerne ‚Äì Budget & Forbrug</title>

  <!-- App icon -->
  <link rel="apple-touch-icon" href="icon-192.jpg" />
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' x2='1' y1='0' y2='1'%3E%3Cstop offset='0' stop-color='%236c5ce7'/%3E%3Cstop offset='1' stop-color='%23a855f7'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='64' height='64' rx='18' ry='18' fill='url(%23g)'/%3E%3Ctext x='50%25' y='56%25' text-anchor='middle' font-size='30' fill='white'%3E%E2%82%B1%3C/text%3E%3C/svg%3E" />
  <meta name="theme-color" content="#6c5ce7" />

  <style>
    :root {
      --bg: #020617;
      --bg-card: rgba(12, 15, 34, 0.96);
      --primary: #8b5cf6;
      --primary-soft: rgba(139, 92, 246, 0.18);
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.2);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --danger: #fb7185;
      --danger-soft: rgba(248, 113, 113, 0.2);
      --border-subtle: rgba(148, 163, 184, 0.5);
      --radius-lg: 20px;
      --radius-md: 12px;
      --shadow-soft: 0 26px 80px rgba(15, 23, 42, 0.9);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      background:
        radial-gradient(circle at top left, rgba(59,130,246,0.23), transparent 55%),
        radial-gradient(circle at bottom right, rgba(244,114,182,0.24), transparent 55%),
        repeating-linear-gradient(135deg, #020617 0, #020617 2px, #030712 2px, #030712 4px);
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-enter {
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards;
    }
    .delay-1 { animation-delay: 0.05s; }
    .delay-2 { animation-delay: 0.1s; }
    .delay-3 { animation-delay: 0.15s; }

    .wrapper {
      max-width: 1100px;
      width: 100%;
      margin: 16px;
      background:
        radial-gradient(circle at top left, rgba(129,140,248,0.15), transparent 50%),
        radial-gradient(circle at bottom right, rgba(34,197,94,0.12), transparent 55%),
        rgba(15,23,42,0.9);
      border-radius: 26px;
      box-shadow: var(--shadow-soft);
      padding: 18px 14px 24px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      backdrop-filter: blur(18px);
    }
    @media (min-width: 768px) {
      .wrapper {
        margin: 28px 16px;
        padding: 24px 24px 30px;
      }
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 8px;
    }
    @media (min-width: 880px) {
      header {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }
    }

    h1 {
      margin: 0;
      font-size: 22px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #f9fafb;
    }
    @media (min-width: 768px) { h1 { font-size: 26px; } }
    h1 .flag { font-size: 24px; }

    header p {
      margin: 2px 0 0;
      font-size: 12px;
      color: var(--text-muted);
    }
    @media (min-width: 768px) { header p { font-size: 13px; } }

    .pill-header {
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(129, 140, 248, 0.2);
      color: #e0e7ff;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .pill-header-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 3px rgba(22,163,74,0.4);
    }

    .sub-note {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 4px;
    }

    .profile-switch {
      display: inline-flex;
      margin-top: 10px;
      border-radius: 999px;
      padding: 4px;
      background: radial-gradient(circle at top left, rgba(129,140,248,0.3), rgba(30,64,175,0.9));
      border: 1px solid rgba(129,140,248,0.9);
      gap: 4px;
      box-shadow: 0 16px 36px rgba(30,64,175,0.9);
    }
    .profile-btn {
      border-radius: 999px;
      border: none;
      padding: 7px 13px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      background: transparent;
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.15s ease, color 0.15s ease, transform 0.08s ease, box-shadow 0.12s ease;
    }
    .profile-btn span.badge {
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 10px;
      background: rgba(15,118,110,0.3);
      color: #a7f3d0;
    }
    .profile-btn-active {
      background: radial-gradient(circle at top left, #4f46e5, #a855f7);
      color: #f9fafb;
      transform: translateY(-1px);
      box-shadow: 0 12px 32px rgba(88,80,236,0.95);
    }
    .profile-btn-active span.badge {
      background: rgba(15,23,42,0.6);
      color: #e0f2fe;
    }

    .layout {
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
      margin-top: 12px;
    }
    @media (min-width: 880px) {
      .layout {
        grid-template-columns: minmax(320px, 1.1fr) minmax(280px, 0.9fr);
        gap: 18px;
      }
    }

    .card {
      background:
        radial-gradient(circle at top left, rgba(129,140,248,0.12), transparent 55%),
        radial-gradient(circle at bottom right, rgba(34,197,94,0.12), transparent 55%),
        var(--bg-card);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 14px 14px 16px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 22px 48px rgba(15,23,42,0.95);
      transition: transform 0.12s ease, box-shadow 0.16s ease, border-color 0.16s ease;
    }
    @media (min-width: 768px) {
      .card { padding: 16px 18px 18px; }
    }
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 26px 65px rgba(15,23,42,1);
      border-color: rgba(191,219,254,0.85);
    }

    .card-inner { position: relative; z-index: 1; }

    h2 {
      margin: 6px 0 4px;
      font-size: 15px;
      font-weight: 600;
      color: #f9fafb;
    }
    @media (min-width: 768px) { h2 { font-size: 17px; } }

    p {
      font-size: 12px;
      color: var(--text-muted);
      margin: 0 0 8px;
    }
    @media (min-width: 768px) { p { font-size: 13px; } }

    label {
      display: block;
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 3px;
      color: var(--text-main);
    }

    .field-group { margin-bottom: 8px; }

    input[type="number"] {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.75);
      padding: 7px 11px;
      font-size: 13px;
      color: #e5e7eb;
      background: linear-gradient(135deg, rgba(15,23,42,0.95), rgba(15,23,42,0.85));
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease, transform 0.05s ease;
      -webkit-appearance: none;
      appearance: none;
    }
    input[type="number"]:focus {
      outline: none;
      border-color: #a855f7;
      box-shadow: 0 0 0 2px rgba(168,85,247,0.4);
      background: radial-gradient(circle at top left, rgba(55,65,194,0.6), rgba(15,23,42,0.95));
      transform: translateY(-1px);
    }

    small {
      font-size: 11px;
      color: var(--text-muted);
      display: block;
      margin-top: 2px;
    }

    .badge-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(30,64,175,0.6);
      color: #e0e7ff;
      font-size: 11px;
      font-weight: 500;
      margin-bottom: 4px;
      border: 1px solid rgba(191,219,254,0.6);
    }
    .badge-pill span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 3px rgba(22,163,74,0.45);
    }

    .btn-row {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 8px 15px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.08s ease, box-shadow 0.12s ease, background 0.12s ease, border-color 0.12s ease;
    }

    .btn-primary {
      background: radial-gradient(circle at top left, #4f46e5, #a855f7);
      color: #f9fafb;
      box-shadow: 0 12px 32px rgba(88,80,236,0.95);
      border: 1px solid rgba(191,219,254,0.5);
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 42px rgba(88,80,236,1);
    }

    .btn-secondary {
      background: radial-gradient(circle at top left, rgba(15,23,42,1), rgba(30,64,175,0.9));
      color: #e5e7eb;
      border: 1px solid rgba(148,163,184,0.9);
    }
    .btn-secondary:hover {
      background: radial-gradient(circle at top left, rgba(30,64,175,1), rgba(15,23,42,0.95));
      transform: translateY(-1px);
      box-shadow: 0 12px 30px rgba(15,23,42,0.95);
    }

    .btn-ghost {
      background: transparent;
      border: 1px dashed rgba(148,163,184,0.75);
      color: #e5e7eb;
    }
    .btn-ghost:hover {
      background: radial-gradient(circle at top left, rgba(30,64,175,0.5), rgba(15,23,42,0.95));
      transform: translateY(-1px);
      box-shadow: 0 10px 26px rgba(15,23,42,0.9);
    }

    hr {
      border: none;
      border-top: 1px dashed rgba(148, 163, 184, 0.6);
      margin: 12px 0 10px;
    }

    .result-main {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 4px;
      color: #f9fafb;
    }
    @media (min-width: 768px) { .result-main { font-size: 20px; } }

    .result-sub {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }
    @media (min-width: 768px) { .result-sub { font-size: 13px; } }

    .tag-ok,
    .tag-warning {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      display: inline-block;
      margin-top: 4px;
    }
    .tag-ok {
      color: #bbf7d0;
      background: var(--accent-soft);
      border: 1px solid rgba(34,197,94,0.75);
    }
    .tag-warning {
      color: #fecaca;
      background: var(--danger-soft);
      border: 1px solid rgba(248,113,113,0.8);
    }

    .daily-wrapper { margin-top: 18px; }

    .table-wrap {
      margin-top: 10px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(148,163,184,0.7);
      overflow: auto;
      max-height: 260px;
      background: radial-gradient(circle at top left, rgba(30,64,175,0.6), rgba(15,23,42,1));
      -webkit-overflow-scrolling: touch;
      box-shadow: inset 0 0 0 1px rgba(15,23,42,0.9);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
      min-width: 540px;
      color: #e5e7eb;
    }

    thead {
      position: sticky;
      top: 0;
      background: linear-gradient(90deg, rgba(30,64,175,0.95), rgba(56,189,248,0.95));
      z-index: 1;
    }

    th, td {
      padding: 6px 6px;
      border-bottom: 1px solid rgba(15,23,42,0.9);
      text-align: right;
      white-space: nowrap;
    }

    th:first-child, td:first-child {
      text-align: left;
      position: sticky;
      left: 0;
      background: rgba(15,23,42,0.98);
      z-index: 2;
    }

    th {
      font-weight: 600;
      color: #e5e7eb;
      font-size: 11px;
    }

    tr:nth-child(even) td { background: rgba(15,23,42,0.94); }
    tr:nth-child(odd) td { background: rgba(17,24,39,0.96); }

    .day-sum {
      font-weight: 600;
      color: #fef9c3;
    }

    .rate-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-top: 8px;
    }
    .rate-row > div { flex: 1 1 160px; }

    .mini-input { max-width: 190px; }

    .note-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.96);
      border: 1px dashed rgba(148,163,184,0.75);
      font-size: 11px;
      color: #cbd5f5;
      margin-top: 4px;
    }
    .note-chip span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }

    .funfact-text {
      font-size: 12px;
      color: #e5e7eb;
      line-height: 1.4;
      margin-top: 6px;
    }

    @media (min-width: 900px) {
      .facts-layout {
        display: grid;
        grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
        gap: 16px;
      }
    }

    .dig-only { /* kun vist for din profil (JS styrer display) */ }
  </style>
</head>
<body>
  <div class="wrapper">
    <header class="animate-enter">
      <div>
        <div class="pill-header">
          <span class="pill-header-dot"></span>
          Budget & forbrug ‚Äì Filippinerne
        </div>
        <h1><span class="flag">üáµüá≠</span> Filippinerne ‚Äì Budget overblik</h1>
        <p>
          Din profil d√¶kker hele turen <strong>29. november ‚Äì 30. januar (63 dage)</strong>.<br />
          Mustis profil d√¶kker kun hans bes√∏g <strong>15. januar ‚Äì 30. januar (16 dage)</strong>.
        </p>
      </div>
    </header>

    <!-- PROFILSKIFTER -->
    <div class="profile-switch animate-enter delay-1">
      <button class="profile-btn profile-btn-active" data-profile-btn="dig" onclick="switchProfile('dig')">
        Dig
        <span class="badge">Hele turen</span>
      </button>
      <button class="profile-btn" data-profile-btn="musti" onclick="switchProfile('musti')">
        Musti
        <span class="badge">15.‚Äì30. januar</span>
      </button>
    </div>
    <p class="sub-note">
      N√•r du v√¶lger <strong>Musti</strong>, er det kun hans startbudget, flybilletter tur/retur og evt. √∏nsket
      opsparing, der t√¶ller. Han har ingen husleje, julegaver eller feriepenge i beregningen.
    </p>

    <div class="layout">
      <!-- INPUTKORT -->
      <div class="card animate-enter delay-2">
        <div class="card-inner">
          <div class="badge-pill">
            <span class="dot"></span>
            Indtast tal for <span id="profileLabelBudget">dig</span>
          </div>

          <h2>Indt√¶gter & startbel√∏b</h2>

          <div class="field-group">
            <label for="startCash" id="startCashLabel">
              Startopsparing inden du rejser (kr)
            </label>
            <input type="number" id="startCash" />
          </div>

          <div class="dig-only">
            <div class="field-group">
              <label for="decSalary">L√∏n 23. december (efter skat, kr)</label>
              <input type="number" id="decSalary" />
            </div>

            <div class="field-group">
              <label for="janSalary">L√∏n 25. januar (efter skat, kr)</label>
              <input type="number" id="janSalary" />
            </div>

            <div class="field-group">
              <label for="decHoliday">Feriepenge i december (kr)</label>
              <input type="number" id="decHoliday" />
            </div>

            <div class="field-group">
              <label for="janHoliday">Feriepenge i januar (kr)</label>
              <input type="number" id="janHoliday" />
            </div>
          </div>

          <hr />

          <h2>Faste udgifter</h2>

          <div class="dig-only">
            <div class="field-group">
              <label for="travelOut">Rejseudgifter ud (fly + hotel + Manila‚ÜíDavao) (kr)</label>
              <input type="number" id="travelOut" />
            </div>
          </div>

          <div class="field-group">
            <label for="travelHome" id="travelHomeLabel">
              Returbillet 30. januar (kr)
            </label>
            <input type="number" id="travelHome" />
          </div>

          <div class="dig-only">
            <div class="field-group">
              <label for="decRent">Husleje december (kr)</label>
              <input type="number" id="decRent" />
            </div>

            <div class="field-group">
              <label for="janRent">Husleje januar (kr)</label>
              <input type="number" id="janRent" />
            </div>

            <div class="field-group">
              <label for="febRent">Husleje februar (kr)</label>
              <input type="number" id="febRent" />
              <small>Fx hvis du betaler husleje 1. februar for hele m√•neden.</small>
            </div>

            <div class="field-group">
              <label for="xmasGifts">Julegaver til familie (kr)</label>
              <input type="number" id="xmasGifts" />
            </div>

            <div class="field-group">
              <label for="friendCost">Ekstra forbrug mens ven er der (kr)</label>
              <input type="number" id="friendCost" />
            </div>
          </div>

          <div class="field-group">
            <label for="targetSavings">Opsparing du vil have tilbage efter perioden (kr)</label>
            <input type="number" id="targetSavings" />
            <small>Fx hvis du vil undg√•, at kontoen er helt tom, n√•r perioden er slut.</small>
          </div>

          <hr />

          <h2>Forventet dagsforbrug</h2>
          <div class="field-group">
            <label for="expectedDaily">Forventet gennemsnitligt dagsforbrug (kr/dag)</label>
            <input type="number" id="expectedDaily" />
            <small>Mad, transport, hygge osv. App‚Äôen tjekker, om det matcher budgettet.</small>
          </div>

          <div class="btn-row">
            <button class="btn-primary" onclick="calculate()">
              üí° Beregn budget for <span id="profileLabelBudgetBtn">dig</span>
            </button>
            <button class="btn-secondary" onclick="resetDefaults()">
              Nulstil profilens standard
            </button>
          </div>
        </div>
      </div>

      <!-- RESULTATKORT -->
      <div class="card animate-enter delay-3">
        <div class="card-inner">
          <div class="badge-pill" style="background: rgba(21,128,61,0.5); border-color: rgba(74,222,128,0.85);">
            <span class="dot" style="background:#4ade80;"></span>
            Resultat ‚Äì <span id="profileLabelResult">dig</span>
          </div>

          <h2>Overblik for perioden</h2>
          <div class="result-sub" id="totalInfo">
            Tryk <strong>‚ÄúBeregn budget‚Äù</strong> for at se dit overblik.
          </div>

          <hr />

          <h2>Maksimalt hyggeforbrug</h2>
          <div class="result-main" id="totalHygge">‚Äì</div>
          <div class="result-sub" id="dailyMax">‚Äì</div>
          <div class="result-sub" id="monthSplit">‚Äì</div>

          <hr />

          <h2>Tjek af dit forventede dagsforbrug</h2>
          <div class="result-sub" id="expectedCheck">‚Äì</div>
          <div id="expectedTag"></div>
        </div>
      </div>
    </div>

    <!-- DAGLIG PESO + FUN FACTS -->
    <div class="daily-wrapper facts-layout">
      <div class="card animate-enter delay-2">
        <div class="card-inner">
          <div class="badge-pill" style="background: rgba(37,99,235,0.6); border-color: rgba(59,130,246,0.95);">
            <span class="dot" style="background:#0ea5e9;"></span>
            Dagligt forbrug i pesos ‚Äì <span id="profileLabelDaily">dig</span>
          </div>
          <h2>Regnskab for perioden</h2>
          <p>
            Skriv hvad du bruger i <strong>pesos</strong> p√• mad, shopping, taxa/transport og diverse 
            for de dage, du vil tracke. Du f√•r samlet forbrug og gennemsnit pr. dag ‚Äì ogs√• omregnet til kroner.
          </p>

          <div class="rate-row">
            <div class="field-group mini-input">
              <label for="rateDKK">Valutakurs ‚Äì hvor mange pesos er 1 DKK?</label>
              <input type="number" id="rateDKK" />
              <small>Fx hvis 1 DKK ‚âà 8 pesos, s√• skriv 8.</small>
            </div>
            <div>
              <button class="btn-primary" onclick="calculateDailySpending()">
                üìä Beregn ud fra dagligt forbrug
              </button>
              <div class="note-chip">
                <span class="dot"></span>
                Du beh√∏ver ikke udfylde alle dage ‚Äì kun dem, du vil tracke.
              </div>
            </div>
          </div>

          <p class="result-sub" id="dailySummary">
            Udfyld nogle dage og tryk <strong>‚ÄúBeregn ud fra dagligt forbrug‚Äù</strong>.
          </p>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Dato</th>
                  <th>Mad (‚Ç±)</th>
                  <th>Shopping (‚Ç±)</th>
                  <th>Taxa / transport (‚Ç±)</th>
                  <th>Diverse (‚Ç±)</th>
                  <th>Sum dag (‚Ç±)</th>
                </tr>
              </thead>
              <tbody id="spendBody">
                <!-- r√¶kker laves i JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="card animate-enter delay-3">
        <div class="card-inner">
          <div class="badge-pill" style="background: rgba(250,204,21,0.5); border-color: rgba(252,211,77,0.95); color:#fef9c3;">
            <span class="dot" style="background:#facc15;"></span>
            Fun fact om Filippinerne
          </div>
          <h2>Lidt ekstra hygge-viden</h2>
          <p>
            Tryk p√• knappen for en tilf√¶ldig fun fact om Filippinerne ‚Äì perfekt til smalltalk,
            n√•r I chiller eller er p√• tur.
          </p>

          <div class="btn-row">
            <button class="btn-ghost" onclick="showRandomFact()">
              üé≤ Ny fun fact
            </button>
          </div>

          <div class="funfact-text" id="funFactText">
            Tryk ‚ÄúNy fun fact‚Äù for at f√• den f√∏rste.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Profil-ops√¶tning
    const PROFILE_CONFIG = {
      dig: {
        key: "dig",
        label: "dig",
        daysTotal: 63,
        daysDec: 33,
        daysJan: 30,
        startDate: new Date(2024, 10, 29), // 29. november 2024
        periodLabel: "29/11‚Äì30/1 (63 dage)"
      },
      musti: {
        key: "musti",
        label: "Musti",
        daysTotal: 16,
        daysDec: 0,
        daysJan: 16,
        startDate: new Date(2025, 0, 15), // 15. januar 2025
        periodLabel: "15/1‚Äì30/1 (16 dage)"
      }
    };

    let activeProfile = "dig";
    const STORAGE_PREFIX = "phBudget_v4_";

    const TOP_IDS = [
      "startCash","decSalary","janSalary","decHoliday","janHoliday",
      "travelOut","travelHome",
      "decRent","janRent","febRent",
      "xmasGifts","friendCost","targetSavings",
      "expectedDaily","rateDKK"
    ];

    function storageKey(profile = activeProfile) {
      return STORAGE_PREFIX + profile;
    }

    function kr(amount) {
      if (isNaN(amount)) return "‚Äì";
      return amount.toLocaleString("da-DK", {
        minimumFractionDigits: 0,
        maximumFractionDigits: 0,
      }) + " kr";
    }

    // ---------- LOCALSTORAGE ----------
    function saveState() {
      try {
        const state = { top: {}, daily: [] };

        TOP_IDS.forEach(id => {
          const el = document.getElementById(id);
          if (el) state.top[id] = el.value;
        });

        const tbody = document.getElementById("spendBody");
        const rows = tbody ? tbody.querySelectorAll("tr") : [];
        rows.forEach(row => {
          const inputs = row.querySelectorAll("input[type='number']");
          const dayObj = {};
          inputs.forEach(input => {
            const cat = input.getAttribute("data-cat") || "";
            dayObj[cat] = input.value;
          });
          state.daily.push(dayObj);
        });

        localStorage.setItem(storageKey(), JSON.stringify(state));
      } catch (e) {
        // ignore
      }
    }

    function loadState() {
      try {
        const raw = localStorage.getItem(storageKey());
        if (!raw) return;
        const state = JSON.parse(raw);

        if (state.top) {
          TOP_IDS.forEach(id => {
            const el = document.getElementById(id);
            if (el && state.top[id] !== undefined) {
              el.value = state.top[id];
            }
          });
        }

        if (state.daily && Array.isArray(state.daily)) {
          const tbody = document.getElementById("spendBody");
          const rows = tbody.querySelectorAll("tr");
          rows.forEach((row, i) => {
            const dayData = state.daily[i] || {};
            const inputs = row.querySelectorAll("input[type='number']");
            inputs.forEach(input => {
              const cat = input.getAttribute("data-cat") || "";
              if (dayData[cat] !== undefined) {
                input.value = dayData[cat];
              } else {
                input.value = "";
              }
            });
          });
        }
      } catch (e) {
        // ignore
      }
    }

    function attachInputListeners() {
      TOP_IDS.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.oninput = () => saveState();
        }
      });

      const tbody = document.getElementById("spendBody");
      const inputs = tbody.querySelectorAll("input[type='number']");
      inputs.forEach(input => {
        input.oninput = () => saveState();
      });
    }

    // ---------- PROFIL DEFAULTS ----------
    function setProfileDefaults(profile) {
      if (profile === "dig") {
        document.getElementById("startCash").value   = 20000;
        document.getElementById("decSalary").value   = 19000;
        document.getElementById("janSalary").value   = 19000;
        document.getElementById("decHoliday").value  = 2000;
        document.getElementById("janHoliday").value  = 2000;
        document.getElementById("travelOut").value   = 4000;
        document.getElementById("travelHome").value  = 5000;
        document.getElementById("decRent").value     = 5000;
        document.getElementById("janRent").value     = 5000;
        document.getElementById("febRent").value     = 5000;
        document.getElementById("xmasGifts").value   = 3000;
        document.getElementById("friendCost").value  = 8000;
        document.getElementById("targetSavings").value = 2000;
        document.getElementById("expectedDaily").value = 350;
        document.getElementById("rateDKK").value = 8;
      } else {
        // Musti: alt starter tomt, undtagen valutakurs
        TOP_IDS.forEach(id => {
          const el = document.getElementById(id);
          if (!el) return;
          if (id === "rateDKK") {
            el.value = 8;
          } else {
            el.value = "";
          }
        });
      }

      document.getElementById("totalInfo").textContent =
        "Tryk ‚ÄúBeregn budget‚Äù for at se dit overblik for denne profil.";
      document.getElementById("totalHygge").textContent = "‚Äì";
      document.getElementById("dailyMax").textContent = "‚Äì";
      document.getElementById("monthSplit").textContent = "‚Äì";
      document.getElementById("expectedCheck").textContent = "‚Äì";
      const tag = document.getElementById("expectedTag");
      tag.textContent = "";
      tag.className = "";

      document.getElementById("dailySummary").textContent =
        "Udfyld nogle dage og tryk ‚ÄúBeregn ud fra dagligt forbrug‚Äù.";
    }

    function setProfileLabels() {
      const cfg = PROFILE_CONFIG[activeProfile];
      const label = cfg.label;
      document.getElementById("profileLabelBudget").textContent = label;
      document.getElementById("profileLabelBudgetBtn").textContent = label;
      document.getElementById("profileLabelResult").textContent = label;
      document.getElementById("profileLabelDaily").textContent = label;
    }

    function updateFieldVisibilityAndLabels() {
      const startLabel = document.getElementById("startCashLabel");
      const travelHomeLabel = document.getElementById("travelHomeLabel");
      const digOnlyBlocks = document.querySelectorAll(".dig-only");

      if (activeProfile === "dig") {
        startLabel.textContent = "Startopsparing inden du rejser (kr)";
        travelHomeLabel.textContent = "Returbillet 30. januar (kr)";
        digOnlyBlocks.forEach(el => el.style.display = "");
      } else {
        startLabel.textContent = "Mustis startbudget n√•r han lander (kr)";
        travelHomeLabel.textContent = "Flybilletter tur/retur (kr)";
        digOnlyBlocks.forEach(el => el.style.display = "none");
      }
    }

    function switchProfile(newProfile) {
      if (!PROFILE_CONFIG[newProfile] || newProfile === activeProfile) return;

      // Gem nuv√¶rende profil
      saveState();

      activeProfile = newProfile;

      // Opdater knapper
      document.querySelectorAll("[data-profile-btn]").forEach(btn => {
        const id = btn.getAttribute("data-profile-btn");
        if (id === activeProfile) {
          btn.classList.add("profile-btn-active");
        } else {
          btn.classList.remove("profile-btn-active");
        }
      });

      // Byg tabel for ny profil
      buildDailyTable();

      // Hvis gemt data ‚Üí load, ellers defaults
      if (localStorage.getItem(storageKey())) {
        loadState();
      } else {
        setProfileDefaults(activeProfile);
      }

      setProfileLabels();
      updateFieldVisibilityAndLabels();
      attachInputListeners();
      calculate();
      calculateDailySpending();
    }

    // --------- Budget i DKK ---------
    function calculate() {
      const cfg = PROFILE_CONFIG[activeProfile];
      const daysTotal = cfg.daysTotal;
      const daysDec = cfg.daysDec;
      const daysJan = cfg.daysJan;

      const startCash   = Number(document.getElementById("startCash").value)   || 0;
      const decSalary   = Number(document.getElementById("decSalary").value)   || 0;
      const janSalary   = Number(document.getElementById("janSalary").value)   || 0;
      const decHoliday  = Number(document.getElementById("decHoliday").value)  || 0;
      const janHoliday  = Number(document.getElementById("janHoliday").value)  || 0;

      const travelOut   = Number(document.getElementById("travelOut").value)   || 0;
      const travelHome  = Number(document.getElementById("travelHome").value)  || 0;
      const decRent     = Number(document.getElementById("decRent").value)     || 0;
      const janRent     = Number(document.getElementById("janRent").value)     || 0;
      const febRent     = Number(document.getElementById("febRent").value)     || 0;
      const xmasGifts   = Number(document.getElementById("xmasGifts").value)   || 0;
      const friendCost  = Number(document.getElementById("friendCost").value)  || 0;
      const targetSave  = Number(document.getElementById("targetSavings").value) || 0;

      const expectedDaily = Number(document.getElementById("expectedDaily").value) || 0;

      let totalIn, totalFixed;

      if (activeProfile === "dig") {
        totalIn =
          startCash +
          decSalary + janSalary +
          decHoliday + janHoliday;

        totalFixed =
          travelOut + travelHome +
          decRent + janRent + febRent +
          xmasGifts + friendCost +
          targetSave;
      } else {
        // Musti: kun startbudget + flybilletter + opsparing
        totalIn = startCash;
        totalFixed = travelHome + targetSave;
      }

      const hyggePool = totalIn - totalFixed;

      const totalInfo =
        `Profil: ${cfg.label}. Du har i alt ${kr(totalIn)} at g√∏re godt med. ` +
        `Faste ting i beregningen for denne profil udg√∏r ${kr(totalFixed)}.`;
      document.getElementById("totalInfo").textContent = totalInfo;

      const totalHyggeEl = document.getElementById("totalHygge");
      const dailyMaxEl = document.getElementById("dailyMax");
      const monthSplitEl = document.getElementById("monthSplit");
      const expectedCheckEl = document.getElementById("expectedCheck");
      const expectedTagEl = document.getElementById("expectedTag");

      if (hyggePool <= 0) {
        totalHyggeEl.textContent = kr(hyggePool);
        dailyMaxEl.textContent =
          "Der er ikke penge tilbage til dagligt forbrug med de nuv√¶rende tal og opsparingsm√•l.";
        monthSplitEl.textContent =
          "Hvis du vil have hyggebudget, skal du enten s√¶nke nogle udgifter eller opsparingen ‚Äì eller have flere penge ind.";
        expectedCheckEl.textContent = "";
        expectedTagEl.textContent = "";
        expectedTagEl.className = "";
        saveState();
        return;
      }

      const dailyMax = hyggePool / daysTotal;
      totalHyggeEl.textContent =
        `${kr(hyggePool)} kan bruges p√• mad, ture og hygge i hele perioden (${cfg.periodLabel}).`;
      dailyMaxEl.textContent =
        `Det svarer til ca. ${kr(dailyMax)} pr. dag i gennemsnit.`;

      if (activeProfile === "dig") {
        const decBudget = hyggePool * (daysDec / daysTotal);
        const janBudget = hyggePool * (daysJan / daysTotal);
        monthSplitEl.textContent =
          `Fordelt ca.: ${kr(decBudget)} til 29/11‚Äì31/12 og ${kr(janBudget)} til 1/1‚Äì30/1.`;
      } else {
        monthSplitEl.textContent =
          `Periode: 15/1‚Äì30/1 (16 dage). Hele hyggebudgettet fordeles over de 16 dage.`;
      }

      if (expectedDaily > 0) {
        const expectedTotal = expectedDaily * daysTotal;
        const diff = hyggePool - expectedTotal;

        expectedCheckEl.textContent =
          `Hvis du bruger ca. ${kr(expectedDaily)} pr. dag, vil du i alt bruge ${kr(expectedTotal)} ` +
          `i perioden p√• dagligt forbrug.`;

        if (Math.round(diff) >= 0) {
          expectedTagEl.textContent =
            `Det er indenfor budget ‚Äì du vil stadig n√• dit opsparingsm√•l og have ca. ${kr(diff)} ekstra luft.`;
          expectedTagEl.className = "tag-ok";
        } else {
          expectedTagEl.textContent =
            `Det er over budget ‚Äì du mangler ca. ${kr(-diff)} for at kunne bruge s√• meget pr. dag ` +
            `og stadig n√• dit opsparingsm√•l.`;
          expectedTagEl.className = "tag-warning";
        }
      } else {
        expectedCheckEl.textContent =
          "Indtast et forventet dagsforbrug for at tjekke, om det passer med dit budget.";
        expectedTagEl.textContent = "";
        expectedTagEl.className = "";
      }

      saveState();
    }

    function resetDefaults() {
      setProfileDefaults(activeProfile);
      saveState();
      calculate();
      calculateDailySpending();
    }

    // --------- Daglig pesos-tracker ---------
    function buildDailyTable() {
      const cfg = PROFILE_CONFIG[activeProfile];
      const tbody = document.getElementById("spendBody");
      tbody.innerHTML = "";

      for (let i = 0; i < cfg.daysTotal; i++) {
        const date = new Date(cfg.startDate);
        date.setDate(date.getDate() + i);

        const label = date.toLocaleDateString("da-DK", {
          day: "2-digit",
          month: "2-digit",
        });

        const tr = document.createElement("tr");

        const tdDate = document.createElement("td");
        tdDate.textContent = label;
        tr.appendChild(tdDate);

        const cats = ["food", "shopping", "taxi", "other"];
        cats.forEach(cat => {
          const td = document.createElement("td");
          const input = document.createElement("input");
          input.type = "number";
          input.min = "0";
          input.step = "1";
          input.style.width = "72px";
          input.setAttribute("data-day", i.toString());
          input.setAttribute("data-cat", cat);
          td.appendChild(input);
          tr.appendChild(td);
        });

        const tdSum = document.createElement("td");
        tdSum.className = "day-sum";
        tdSum.textContent = "‚Äì";
        tr.appendChild(tdSum);

        tbody.appendChild(tr);
      }
    }

    function calculateDailySpending() {
      const cfg = PROFILE_CONFIG[activeProfile];
      const tbody = document.getElementById("spendBody");
      const rows = tbody.querySelectorAll("tr");
      let totalPesos = 0;
      let daysWithSpend = 0;

      rows.forEach(row => {
        const inputs = row.querySelectorAll("input[type='number']");
        let daySum = 0;
        inputs.forEach(input => {
          const v = Number(input.value) || 0;
          daySum += v;
        });
        if (daySum > 0) daysWithSpend++;
        totalPesos += daySum;

        const sumCell = row.querySelector(".day-sum");
        if (sumCell) {
          sumCell.textContent =
            daySum > 0 ? daySum.toLocaleString("da-DK") + " ‚Ç±" : "‚Äì";
        }
      });

      const rate = Number(document.getElementById("rateDKK").value) || 0;
      let summary = "";

      if (totalPesos <= 0) {
        summary = "Udfyld nogle bel√∏b i tabellen og tryk p√• knappen for at se dit samlede forbrug.";
      } else {
        summary =
          "Samlet registreret forbrug for " + PROFILE_CONFIG[activeProfile].label +
          ": " + totalPesos.toLocaleString("da-DK") + " ‚Ç±";

        if (rate > 0) {
          const totalDKK = totalPesos / rate;
          const divisor = daysWithSpend > 0 ? daysWithSpend : cfg.daysTotal;
          const avgPesos = totalPesos / divisor;
          const avgDKK = avgPesos / rate;

          summary +=
            " (ca. " + kr(totalDKK) +
            "). Gennemsnit pr. dag (" + divisor +
            " dage): " +
            avgPesos.toLocaleString("da-DK", { maximumFractionDigits: 0 }) +
            " ‚Ç± (ca. " +
            avgDKK.toLocaleString("da-DK", { maximumFractionDigits: 0 }) +
            " kr/dag).";
        } else {
          summary += ". Indtast en valutakurs for at se bel√∏bet i kroner.";
        }
      }

      document.getElementById("dailySummary").textContent = summary;
      saveState();
    }

    // ---------- FUN FACTS ----------
    const funFacts = [
      "Filippinerne best√•r af mere end 7.600 √∏er.",
      "Landet har tre hoved√∏grupper: Luzon, Visayas og Mindanao.",
      "Filippinere taler mere end 170 forskellige sprog og dialekter.",
      "De officielle sprog er filipino (baseret p√• tagalog) og engelsk.",
      "Manila er hovedstaden, men Quezon City er den mest befolkede by.",
      "Filippinerne er kendt som verdens SMS-hovedstad.",
      "Jeepneys er ikoniske farverige minibusser lavet fra gamle milit√¶rjeeps.",
      "Filippinerne ligger i en tyfon-zone og oplever mange tropiske storme.",
      "Landet ligger p√• Stillehavets Ildring og har flere aktive vulkaner.",
      "Mayon-vulkanen er kendt for sin n√¶sten perfekte kegleform.",
      "Filippinerne er et af verdens mest biodiversitetsrige lande.",
      "Tarsieren, et af verdens mindste primater, findes p√• Bohol.",
      "Whale sharks (butanding) kan ses bl.a. ved Donsol og Oslob.",
      "Filippinerne er en stor eksport√∏r af kokosn√∏dder og kokosprodukter.",
      "Mange filippinere arbejder i udlandet som OFW (Overseas Filipino Workers).",
      "Filippinere er kendt for st√¶rke familiev√¶rdier og store familiesammenkomster.",
      "Julefejringen starter ofte allerede i september.",
      "Lechon (helstegt gris) er en klassisk festret i Filippinerne.",
      "Adobo og sinigang er to af de mest kendte filippinske retter.",
      "Halo-halo er en popul√¶r dessert med is, frugt og knust is.",
      "Filippinerne var en spansk koloni i mere end 300 √•r.",
      "Mange filippinere har spanske efternavne som Santos, Reyes og Garcia.",
      "Katolicisme er den dominerende religion i Filippinerne.",
      "Filippinske fiestaer fejres n√¶sten overalt i landet.",
      "Landet fik sit navn efter kong Filip II af Spanien.",
      "Filippinerne var ogs√• under amerikansk styre i starten af 1900-tallet.",
      "Basketball er en af de mest popul√¶re sportsgrene i Filippinerne.",
      "Karaoke (videoke) er k√¶mpe stort, b√•de hjemme og i barer.",
      "Filippinerne er kendt for dygtige sangere, lokalt og internationalt.",
      "Boracay er ber√∏mt for sine smukke hvide sandstrande.",
      "Palawan bliver ofte kaldt en af verdens smukkeste √∏er.",
      "Filippinerne producerer meget mango, is√¶r fra Guimaras.",
      "Jollibee er en stor filippinsk fastfoodk√¶de og et nationalt ikon.",
      "Filippinere er kendt for g√¶stfrihed og at f√• g√¶ster til at f√∏le sig hjemme.",
      "Mange filippinere er tosprogede eller flersprogede fra barnsben.",
      "Respekt for √¶ldre vises bl.a. ved at sige ‚Äúpo‚Äù og ‚Äúopo‚Äù.",
      "Traditionen ‚Äúmano po‚Äù er at tage en √¶ldres h√•nd til panden som respekt.",
      "Filippinerne har en meget ung befolkning med lav gennemsnitsalder.",
      "Landet har en stor BPO-industri (callcentre, kundeservice osv.).",
      "Chicharr√≥n, pandesal og lumpia er popul√¶re snacks.",
      "Mange filippinske byer har spansk-inspirerede navne.",
      "Filippinerne har flere UNESCO World Heritage Sites.",
      "Filippinsk tid, ‚ÄúFilipino time‚Äù, er kendt for at v√¶re ret afslappet.",
      "Der er ofte karaoke i malls, p√• gaden og til private fester.",
      "Tricycles og pedicabs er almindelige lokale transportmidler.",
      "Filippinerne er en af verdens st√∏rste producenter af nikkel.",
      "Mange filippinere elsker b√•de K-pop, amerikansk pop og lokal OPM-musik.",
      "Filippinske bryllupper og fester kan vare mange timer.",
      "Filippinsk h√∏flighed og varme g√∏r, at mange rejsende hurtigt f√∏ler sig velkomne.",
      "Filippinerne har en st√¶rk kultur for at hj√¶lpe hinanden i lokalsamfundet."
    ];

    function showRandomFact() {
      const el = document.getElementById("funFactText");
      const idx = Math.floor(Math.random() * funFacts.length);
      el.textContent = funFacts[idx];
    }

    // ---------- INIT ----------
    document.addEventListener("DOMContentLoaded", () => {
      activeProfile = "dig";
      buildDailyTable();

      if (!localStorage.getItem(storageKey("dig"))) {
        setProfileDefaults("dig");
      } else {
        loadState();
      }

      setProfileLabels();
      updateFieldVisibilityAndLabels();
      attachInputListeners();
      calculate();
      calculateDailySpending();
    });
  </script>
</body>
</html>
