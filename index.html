<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Filippinerne ‚Äì Budget & Forbrug</title>

  <!-- App icon / PWA hooks -->
  <link rel="apple-touch-icon" href="icon-192.jpg" />
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='16' ry='16' fill='%236c5ce7'/%3E%3Ctext x='50%25' y='54%25' text-anchor='middle' font-size='32' fill='white'%3E%E2%82%B1%3C/text%3E%3C/svg%3E" />
  <meta name="theme-color" content="#6c5ce7" />

  <style>
    :root {
      --bg: #f5f7fb;
      --bg-card: #ffffff;
      --primary: #6c5ce7;
      --primary-soft: rgba(108, 92, 231, 0.12);
      --accent: #00b894;
      --accent-soft: rgba(0, 184, 148, 0.12);
      --text-main: #1f2933;
      --text-muted: #6b7b93;
      --danger: #ff7675;
      --danger-soft: rgba(255, 118, 117, 0.12);
      --border-subtle: #dde3f0;
      --radius-lg: 18px;
      --radius-md: 12px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.12);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #f9f5ff, #f5f7fb 35%, #e8f6ff);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    /* Simple entrance animation */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-enter {
      opacity: 0;
      animation: fadeInUp 0.55s ease forwards;
    }
    .delay-1 { animation-delay: 0.05s; }
    .delay-2 { animation-delay: 0.1s; }
    .delay-3 { animation-delay: 0.15s; }

    .wrapper {
      max-width: 1100px;
      width: 100%;
      margin: 16px;
      background: linear-gradient(145deg, rgba(255,255,255,0.95), rgba(244,249,255,0.98));
      border-radius: 24px;
      box-shadow: var(--shadow-soft);
      padding: 18px 16px 22px;
      border: 1px solid rgba(209, 213, 224, 0.9);
    }
    @media (min-width: 768px) {
      .wrapper {
        margin: 32px 16px;
        padding: 24px 26px 30px;
      }
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 8px;
    }
    @media (min-width: 880px) {
      header {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }
    }

    h1 {
      margin: 0;
      font-size: 22px;
      font-weight: 700;
      color: #111827;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    @media (min-width: 768px) { h1 { font-size: 26px; } }

    h1 span.flag { font-size: 22px; }

    header p {
      margin: 2px 0 0;
      font-size: 12px;
      color: var(--text-muted);
    }
    @media (min-width: 768px) { header p { font-size: 13px; } }

    .pill-header {
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(108, 92, 231, 0.06);
      color: var(--primary);
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .pill-header-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
    }

    .profile-switch {
      display: inline-flex;
      margin-top: 10px;
      border-radius: 999px;
      padding: 3px;
      background: #e5ecff;
      border: 1px solid #c7d2fe;
      gap: 4px;
    }
    .profile-btn {
      border-radius: 999px;
      border: none;
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      background: transparent;
      color: #4b5563;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.15s ease, color 0.15s ease, transform 0.08s ease;
    }
    .profile-btn span.badge {
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 10px;
      background: rgba(15,118,110,0.08);
      color: #0f766e;
    }
    .profile-btn-active {
      background: #4f46e5;
      color: #ffffff;
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(79,70,229,0.35);
    }
    .profile-btn-active span.badge {
      background: rgba(255,255,255,0.18);
      color: #e0f2fe;
    }

    .layout {
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
      margin-top: 10px;
    }
    @media (min-width: 880px) {
      .layout {
        grid-template-columns: minmax(320px, 1.1fr) minmax(280px, 0.9fr);
        gap: 18px;
      }
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      padding: 14px 14px 16px;
      position: relative;
      overflow: hidden;
    }
    @media (min-width: 768px) {
      .card { padding: 16px 18px 18px; }
    }
    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(circle at top left, rgba(108, 92, 231, 0.1), transparent 55%),
        radial-gradient(circle at bottom right, rgba(0, 184, 148, 0.09), transparent 55%);
      opacity: 0.55;
      mix-blend-mode: multiply;
    }
    .card-inner { position: relative; z-index: 1; }

    h2 {
      margin: 6px 0 4px;
      font-size: 15px;
      font-weight: 600;
    }
    @media (min-width: 768px) { h2 { font-size: 17px; } }

    p {
      font-size: 12px;
      color: var(--text-muted);
      margin: 0 0 8px;
    }
    @media (min-width: 768px) { p { font-size: 13px; } }

    label {
      display: block;
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 3px;
      color: #111827;
    }

    .field-group { margin-bottom: 8px; }

    input[type="number"] {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #d0d7e6;
      padding: 7px 11px;
      font-size: 13px;
      color: var(--text-main);
      background: #f9fbff;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease, transform 0.05s ease;
      -webkit-appearance: none;
      appearance: none;
    }
    input[type="number"]:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(108, 92, 231, 0.25);
      background: #ffffff;
      transform: translateY(-1px);
    }

    small {
      font-size: 11px;
      color: var(--text-muted);
      display: block;
      margin-top: 2px;
    }

    .badge-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 9px;
      border-radius: 999px;
      background: var(--primary-soft);
      color: var(--primary);
      font-size: 11px;
      font-weight: 500;
      margin-bottom: 4px;
    }
    .badge-pill span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--primary);
    }

    .btn-row {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 8px 15px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.08s ease, box-shadow 0.12s ease, background 0.12s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #6c5ce7, #a855f7);
      color: #ffffff;
      box-shadow: 0 10px 25px rgba(108, 92, 231, 0.35);
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 32px rgba(108, 92, 231, 0.4);
    }

    .btn-secondary {
      background: #eef2ff;
      color: #4338ca;
      border: 1px solid #c7d2fe;
    }
    .btn-secondary:hover {
      background: #e0e7ff;
      transform: translateY(-1px);
    }

    .btn-ghost {
      background: transparent;
      border: 1px dashed #d1d5db;
      color: #4b5563;
    }
    .btn-ghost:hover {
      background: #f3f4ff;
      transform: translateY(-1px);
    }

    hr {
      border: none;
      border-top: 1px dashed #dde3f0;
      margin: 12px 0 10px;
    }

    .result-main {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 4px;
      color: #111827;
    }
    @media (min-width: 768px) { .result-main { font-size: 20px; } }

    .result-sub {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }
    @media (min-width: 768px) { .result-sub { font-size: 13px; } }

    .tag-ok, .tag-warning {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      display: inline-block;
      margin-top: 4px;
    }
    .tag-ok {
      color: #0f9f6e;
      background: var(--accent-soft);
    }
    .tag-warning {
      color: #b53d3d;
      background: var(--danger-soft);
    }

    .daily-wrapper { margin-top: 16px; }

    .table-wrap {
      margin-top: 10px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      overflow: auto;
      max-height: 260px;
      background: #f9fbff;
      -webkit-overflow-scrolling: touch;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
      min-width: 540px;
    }

    thead {
      position: sticky;
      top: 0;
      background: #eef2ff;
      z-index: 1;
    }

    th, td {
      padding: 6px 6px;
      border-bottom: 1px solid #e5e9f2;
      text-align: right;
      white-space: nowrap;
    }

    th:first-child, td:first-child {
      text-align: left;
      position: sticky;
      left: 0;
      background: inherit;
      z-index: 2;
    }

    th {
      font-weight: 600;
      color: #4b5563;
      font-size: 11px;
    }

    tr:nth-child(even) td { background: #fdfdff; }
    tr:nth-child(odd) td { background: #f9fbff; }

    .day-sum {
      font-weight: 600;
      color: #111827;
    }

    .rate-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-top: 8px;
    }
    .rate-row > div { flex: 1 1 160px; }

    .mini-input { max-width: 180px; }

    .note-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.9);
      border: 1px dashed #c4d0ea;
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
    }
    .note-chip span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    /* Fun fact card */
    .funfact-text {
      font-size: 12px;
      color: #111827;
      line-height: 1.4;
      margin-top: 4px;
    }
    @media (min-width: 768px) {
      .facts-layout {
        display: grid;
        grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
        gap: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <header class="animate-enter">
      <div>
        <div class="pill-header">
          <span class="pill-header-dot"></span>
          Budget & forbrug ‚Äì Filippinerne
        </div>
        <h1><span class="flag">üáµüá≠</span> Filippinerne ‚Äì Budget overblik</h1>
        <p>
          Perioden er sat til <strong>29. november ‚Äì 30. januar (63 dage)</strong>.
          F√∏rste del er budget i kroner. Nederst kan du f√∏re regnskab dag for dag i pesos.
        </p>
      </div>
    </header>

    <!-- PROFILSKIFTER: DIG / MUSTI -->
    <div class="profile-switch animate-enter delay-1">
      <button class="profile-btn profile-btn-active" data-profile-btn="dig" onclick="switchProfile('dig')">
        Dig
        <span class="badge">Hele perioden</span>
      </button>
      <button class="profile-btn" data-profile-btn="musti" onclick="switchProfile('musti')">
        Musti
        <span class="badge">7 dage</span>
      </button>
    </div>

    <div class="layout">
      <!-- INPUTS -->
      <div class="card animate-enter delay-2">
        <div class="card-inner">
          <div class="badge-pill">
            <span class="dot"></span>
            Indtast dine tal
          </div>

          <h2>Indt√¶gter & startpenge</h2>

          <div class="field-group">
            <label for="startCash">Startopsparing inden du rejser (kr)</label>
            <input type="number" id="startCash" value="20000" />
          </div>

          <div class="field-group">
            <label for="decSalary">L√∏n 23. december (efter skat, kr)</label>
            <input type="number" id="decSalary" value="19000" />
          </div>

          <div class="field-group">
            <label for="janSalary">L√∏n 25. januar (efter skat, kr)</label>
            <input type="number" id="janSalary" value="19000" />
          </div>

          <div class="field-group">
            <label for="decHoliday">Feriepenge i december (kr)</label>
            <input type="number" id="decHoliday" value="2000" />
          </div>

          <div class="field-group">
            <label for="janHoliday">Feriepenge i januar (kr)</label>
            <input type="number" id="janHoliday" value="2000" />
          </div>

          <hr />

          <h2>Faste udgifter (skal betales)</h2>

          <div class="field-group">
            <label for="travelOut">Rejseudgifter ud (fly + hotel + Manila‚ÜíDavao) (kr)</label>
            <input type="number" id="travelOut" value="4000" />
          </div>

          <div class="field-group">
            <label for="travelHome">Returbillet 30. januar (kr)</label>
            <input type="number" id="travelHome" value="5000" />
          </div>

          <div class="field-group">
            <label for="decRent">Husleje december (kr)</label>
            <input type="number" id="decRent" value="5000" />
          </div>

          <div class="field-group">
            <label for="janRent">Husleje januar (kr)</label>
            <input type="number" id="janRent" value="5000" />
          </div>

          <div class="field-group">
            <label for="febRent">Husleje februar (kr)</label>
            <input type="number" id="febRent" value="5000" />
            <small>Du betaler typisk husleje 1. februar for hele februar, selvom du kommer hjem 1. februar.</small>
          </div>

          <div class="field-group">
            <label for="xmasGifts">Julegaver til familie (kr)</label>
            <input type="number" id="xmasGifts" value="3000" />
          </div>

          <div class="field-group">
            <label for="friendCost">Ekstra forbrug mens ven er der (15.‚Äì30. jan) (kr)</label>
            <input type="number" id="friendCost" value="8000" />
          </div>

          <div class="field-group">
            <label for="targetSavings">Opsparing du vil have tilbage efter rejsen (kr)</label>
            <input type="number" id="targetSavings" value="2000" />
            <small>Hvis du vil, at kontoen ikke er helt tom, n√•r du kommer hjem.</small>
          </div>

          <hr />

          <h2>Dit forventede dagsforbrug</h2>
          <div class="field-group">
            <label for="expectedDaily">Forventet gennemsnitligt dagsforbrug (kr/dag)</label>
            <input type="number" id="expectedDaily" value="350" />
            <small>Mad, transport, hygge osv. Siden tjekker, om det passer med budgettet.</small>
          </div>

          <div class="btn-row">
            <button class="btn-primary" onclick="calculate()">
              üí° Beregn budget for <span id="profileLabelBudget">dig</span>
            </button>
            <button class="btn-secondary" onclick="resetDefaults()">
              Nulstil til standard
            </button>
          </div>
        </div>
      </div>

      <!-- RESULTS -->
      <div class="card animate-enter delay-3">
        <div class="card-inner">
          <div class="badge-pill" style="background: var(--accent-soft); color:#047857;">
            <span class="dot" style="background:#10b981;"></span>
            Resultat ‚Äì <span id="profileLabelResult">dig</span>
          </div>

          <h2>Oversigt for hele perioden</h2>
          <div class="result-sub" id="totalInfo">
            Tryk <strong>‚ÄúBeregn budget‚Äù</strong> for at se dit overblik.
          </div>

          <hr />

          <h2>Maksimalt forbrug (for at n√• din opsparing)</h2>
          <div class="result-main" id="totalHygge">‚Äì</div>
          <div class="result-sub" id="dailyMax">‚Äì</div>
          <div class="result-sub" id="monthSplit">‚Äì</div>

          <hr />

          <h2>Tjek af dit forventede dagsforbrug</h2>
          <div class="result-sub" id="expectedCheck">‚Äì</div>
          <div id="expectedTag"></div>
        </div>
      </div>
    </div>

    <!-- DAGLIG PESO-TRACKER + FUN FACTS -->
    <div class="daily-wrapper facts-layout">
      <div class="card animate-enter delay-2">
        <div class="card-inner">
          <div class="badge-pill" style="background: rgba(56,189,248,0.16); color:#0369a1;">
            <span class="dot" style="background:#0ea5e9;"></span>
            Dagligt forbrug i pesos ‚Äì <span id="profileLabelDaily">dig</span>
          </div>
          <h2>Regnskab fra 29. november til 30. januar</h2>
          <p>
            Skriv hvad du bruger i <strong>pesos</strong> p√• mad, shopping, taxa/transport og diverse 
            for de dage, du vil tracke. S√• ser du samlet forbrug og gennemsnit pr. dag ‚Äì ogs√• i kroner.
          </p>

          <div class="rate-row">
            <div class="field-group mini-input">
              <label for="rateDKK">Valutakurs ‚Äì hvor mange pesos er 1 DKK?</label>
              <input type="number" id="rateDKK" value="8" step="0.01" />
              <small>Fx hvis 1 DKK ‚âà 8 pesos, s√• skriv 8.</small>
            </div>
            <div>
              <button class="btn-primary" onclick="calculateDailySpending()">
                üìä Beregn ud fra dagligt forbrug
              </button>
              <div class="note-chip">
                <span class="dot"></span>
                Du beh√∏ver ikke udfylde alle dage ‚Äì kun dem, du vil tracke.
              </div>
            </div>
          </div>

          <p class="result-sub" id="dailySummary">
            Udfyld nogle dage og tryk <strong>‚ÄúBeregn ud fra dagligt forbrug‚Äù</strong>.
          </p>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Dato</th>
                  <th>Mad (‚Ç±)</th>
                  <th>Shopping (‚Ç±)</th>
                  <th>Taxa / transport (‚Ç±)</th>
                  <th>Diverse (‚Ç±)</th>
                  <th>Sum dag (‚Ç±)</th>
                </tr>
              </thead>
              <tbody id="spendBody">
                <!-- R√¶kker genereres i JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- FUN FACTS -->
      <div class="card animate-enter delay-3">
        <div class="card-inner">
          <div class="badge-pill" style="background: rgba(252,211,77,0.25); color:#92400e;">
            <span class="dot" style="background:#f59e0b;"></span>
            Fun fact om Filippinerne
          </div>
          <h2>Lidt ekstra hygge-viden</h2>
          <p>
            Tryk p√• knappen for en tilf√¶ldig fun fact om Filippinerne ‚Äì perfekt til smalltalk eller n√•r I sidder og chiller.
          </p>

          <div class="btn-row">
            <button class="btn-ghost" onclick="showRandomFact()">
              üé≤ Ny fun fact
            </button>
          </div>

          <div class="funfact-text" id="funFactText">
            Tryk ‚ÄúNy fun fact‚Äù for at f√• den f√∏rste.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const DAYS_TOTAL = 63;   // 29. nov ‚Äì 30. jan
    const DAYS_DEC = 33;     // 29/11‚Äì31/12
    const DAYS_JAN = 30;     // 1/1‚Äì30/1
    const DAILY_START = new Date(2024, 10, 29); // 29. november (0-indexed m√•ned 10)

    const PROFILES = ["dig","musti"];
    let activeProfile = "dig";
    const STORAGE_PREFIX = "phBudget_v2_";

    const TOP_IDS = [
      "startCash","decSalary","janSalary","decHoliday","janHoliday",
      "travelOut","travelHome",
      "decRent","janRent","febRent",
      "xmasGifts","friendCost","targetSavings",
      "expectedDaily","rateDKK"
    ];

    function storageKey() {
      return STORAGE_PREFIX + activeProfile;
    }

    function kr(amount) {
      if (isNaN(amount)) return "‚Äì";
      return amount.toLocaleString("da-DK", {
        minimumFractionDigits: 0,
        maximumFractionDigits: 0,
      }) + " kr";
    }

    // ---------- LOCALSTORAGE ----------
    function saveState() {
      try {
        const state = { top: {}, daily: [] };

        TOP_IDS.forEach(id => {
          const el = document.getElementById(id);
          if (el) state.top[id] = el.value;
        });

        const tbody = document.getElementById("spendBody");
        const rows = tbody ? tbody.querySelectorAll("tr") : [];
        rows.forEach(row => {
          const inputs = row.querySelectorAll("input[type='number']");
          const dayObj = {};
          inputs.forEach(input => {
            const cat = input.getAttribute("data-cat") || "";
            dayObj[cat] = input.value;
          });
          state.daily.push(dayObj);
        });

        localStorage.setItem(storageKey(), JSON.stringify(state));
      } catch (e) {
        // ignore
      }
    }

    function loadState() {
      try {
        const raw = localStorage.getItem(storageKey());
        if (!raw) {
          // ingen gemt state ‚Äì bare lade standardv√¶rdier st√•
          return;
        }
        const state = JSON.parse(raw);

        if (state.top) {
          TOP_IDS.forEach(id => {
            const el = document.getElementById(id);
            if (el && state.top[id] !== undefined) {
              el.value = state.top[id];
            }
          });
        }

        if (state.daily && Array.isArray(state.daily)) {
          const tbody = document.getElementById("spendBody");
          const rows = tbody.querySelectorAll("tr");
          rows.forEach((row, i) => {
            const dayData = state.daily[i] || {};
            const inputs = row.querySelectorAll("input[type='number']");
            inputs.forEach(input => {
              const cat = input.getAttribute("data-cat") || "";
              if (dayData[cat] !== undefined) {
                input.value = dayData[cat];
              } else {
                input.value = "";
              }
            });
          });
        }
      } catch (e) {
        // ignore
      }
    }

    function attachInputListeners() {
      TOP_IDS.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.addEventListener("input", () => {
            saveState();
          });
        }
      });

      const tbody = document.getElementById("spendBody");
      const inputs = tbody.querySelectorAll("input[type='number']");
      inputs.forEach(input => {
        input.addEventListener("input", () => {
          saveState();
        });
      });
    }

    // ---------- PROFILSKIFTE ----------
    function setProfileLabels() {
      const labelBudget = document.getElementById("profileLabelBudget");
      const labelResult = document.getElementById("profileLabelResult");
      const labelDaily = document.getElementById("profileLabelDaily");

      if (activeProfile === "dig") {
        labelBudget.textContent = "dig";
        labelResult.textContent = "dig";
        labelDaily.textContent = "dig";
      } else {
        labelBudget.textContent = "Musti";
        labelResult.textContent = "Musti";
        labelDaily.textContent = "Musti";
      }
    }

    function switchProfile(newProfile) {
      if (!PROFILES.includes(newProfile) || newProfile === activeProfile) return;

      // gem nuv√¶rende
      saveState();

      // skift profil
      activeProfile = newProfile;

      // opdat√©r knap-styles
      document.querySelectorAll("[data-profile-btn]").forEach(btn => {
        const id = btn.getAttribute("data-profile-btn");
        if (id === activeProfile) {
          btn.classList.add("profile-btn-active");
        } else {
          btn.classList.remove("profile-btn-active");
        }
      });

      // nul stil p√• daglig tabel visning, men behold struktur
      clearDailyTable(false);
      // load state for ny profil
      loadState();
      setProfileLabels();
      calculate();
      calculateDailySpending();
      attachInputListeners();
    }

    // --------- Budget i DKK ---------
    function calculate() {
      const startCash   = Number(document.getElementById("startCash").value)   || 0;
      const decSalary   = Number(document.getElementById("decSalary").value)   || 0;
      const janSalary   = Number(document.getElementById("janSalary").value)   || 0;
      const decHoliday  = Number(document.getElementById("decHoliday").value)  || 0;
      const janHoliday  = Number(document.getElementById("janHoliday").value)  || 0;

      const travelOut   = Number(document.getElementById("travelOut").value)   || 0;
      const travelHome  = Number(document.getElementById("travelHome").value)  || 0;
      const decRent     = Number(document.getElementById("decRent").value)     || 0;
      const janRent     = Number(document.getElementById("janRent").value)     || 0;
      const febRent     = Number(document.getElementById("febRent").value)     || 0;
      const xmasGifts   = Number(document.getElementById("xmasGifts").value)   || 0;
      const friendCost  = Number(document.getElementById("friendCost").value)  || 0;
      const targetSave  = Number(document.getElementById("targetSavings").value) || 0;

      const expectedDaily = Number(document.getElementById("expectedDaily").value) || 0;

      const totalIn =
        startCash +
        decSalary + janSalary +
        decHoliday + janHoliday;

      const totalFixed =
        travelOut + travelHome +
        decRent + janRent + febRent +
        xmasGifts + friendCost +
        targetSave;

      const hyggePool = totalIn - totalFixed;

      const totalInfo =
        `Du har i alt ${kr(totalIn)} at g√∏re godt med i perioden (startpenge + l√∏n + feriepenge). ` +
        `Dine faste udgifter, husleje for 3 m√•neder, gaver, venneforbrug, returbillet og √∏nsket opsparing ` +
        `er tilsammen ${kr(totalFixed)}.`;
      document.getElementById("totalInfo").textContent = totalInfo;

      const totalHyggeEl = document.getElementById("totalHygge");
      const dailyMaxEl = document.getElementById("dailyMax");
      const monthSplitEl = document.getElementById("monthSplit");
      const expectedCheckEl = document.getElementById("expectedCheck");
      const expectedTagEl = document.getElementById("expectedTag");

      if (hyggePool <= 0) {
        totalHyggeEl.textContent = kr(hyggePool);
        dailyMaxEl.textContent =
          "Der er ikke penge tilbage til dagligt forbrug med de nuv√¶rende tal og opsparingsm√•l.";
        monthSplitEl.textContent =
          "Hvis du vil have hyggebudget, skal du enten s√¶nke nogle udgifter eller opsparingen ‚Äì eller have flere penge ind.";
        expectedCheckEl.textContent = "";
        expectedTagEl.textContent = "";
        expectedTagEl.className = "";
        saveState();
        return;
      }

      const dailyMax = hyggePool / DAYS_TOTAL;
      const decBudget = hyggePool * (DAYS_DEC / DAYS_TOTAL);
      const janBudget = hyggePool * (DAYS_JAN / DAYS_TOTAL);

      totalHyggeEl.textContent =
        `${kr(hyggePool)} kan bruges p√• mad, ture og hygge i hele perioden.`;
      dailyMaxEl.textContent =
        `Det svarer til ca. ${kr(dailyMax)} pr. dag i gennemsnit.`;
      monthSplitEl.textContent =
        `Fordelt ca.: ${kr(decBudget)} til perioden 29/11‚Äì31/12 (33 dage) ` +
        `og ${kr(janBudget)} til januar (30 dage).`;

      if (expectedDaily > 0) {
        const expectedTotal = expectedDaily * DAYS_TOTAL;
        const diff = hyggePool - expectedTotal;

        expectedCheckEl.textContent =
          `Hvis du bruger ca. ${kr(expectedDaily)} pr. dag, vil du i alt bruge ${kr(expectedTotal)} ` +
          `i perioden p√• dagligt forbrug.`;

        if (Math.round(diff) >= 0) {
          expectedTagEl.textContent =
            `Det er indenfor budget ‚Äì du vil stadig n√• dit opsparingsm√•l og have ca. ${kr(diff)} ekstra luft.`;
          expectedTagEl.className = "tag-ok";
        } else {
          expectedTagEl.textContent =
            `Det er over budget ‚Äì du mangler ca. ${kr(-diff)} for at kunne bruge s√• meget pr. dag ` +
            `og stadig n√• dit opsparingsm√•l.`;
          expectedTagEl.className = "tag-warning";
        }
      } else {
        expectedCheckEl.textContent =
          "Indtast et forventet dagsforbrug for at tjekke, om det passer med dit budget.";
        expectedTagEl.textContent = "";
        expectedTagEl.className = "";
      }

      saveState();
    }

    function resetDefaults() {
      document.getElementById("startCash").value   = 20000;
      document.getElementById("decSalary").value   = 19000;
      document.getElementById("janSalary").value   = 19000;
      document.getElementById("decHoliday").value  = 2000;
      document.getElementById("janHoliday").value  = 2000;

      document.getElementById("travelOut").value   = 4000;
      document.getElementById("travelHome").value  = 5000;
      document.getElementById("decRent").value     = 5000;
      document.getElementById("janRent").value     = 5000;
      document.getElementById("febRent").value     = 5000;
      document.getElementById("xmasGifts").value   = 3000;
      document.getElementById("friendCost").value  = 8000;
      document.getElementById("targetSavings").value = 2000;

      document.getElementById("expectedDaily").value = 350;

      document.getElementById("totalInfo").textContent =
        "Tryk ‚ÄúBeregn budget‚Äù for at se dit overblik.";
      document.getElementById("totalHygge").textContent = "‚Äì";
      document.getElementById("dailyMax").textContent = "‚Äì";
      document.getElementById("monthSplit").textContent = "‚Äì";
      document.getElementById("expectedCheck").textContent = "‚Äì";
      const tag = document.getElementById("expectedTag");
      tag.textContent = "";
      tag.className = "";

      document.getElementById("rateDKK").value = 8;
      document.getElementById("dailySummary").textContent =
        "Udfyld nogle dage og tryk ‚ÄúBeregn ud fra dagligt forbrug‚Äù.";

      clearDailyTable(true);
      saveState();
    }

    // --------- Daglig pesos-tracker ---------
    function buildDailyTable() {
      const tbody = document.getElementById("spendBody");
      tbody.innerHTML = "";

      for (let i = 0; i < DAYS_TOTAL; i++) {
        const date = new Date(DAILY_START);
        date.setDate(date.getDate() + i);

        const label = date.toLocaleDateString("da-DK", {
          day: "2-digit",
          month: "2-digit",
        });

        const tr = document.createElement("tr");

        const tdDate = document.createElement("td");
        tdDate.textContent = label;
        tr.appendChild(tdDate);

        const cats = ["food", "shopping", "taxi", "other"];
        cats.forEach(cat => {
          const td = document.createElement("td");
          const input = document.createElement("input");
          input.type = "number";
          input.min = "0";
          input.step = "1";
          input.style.width = "70px";
          input.setAttribute("data-day", i.toString());
          input.setAttribute("data-cat", cat);
          td.appendChild(input);
          tr.appendChild(td);
        });

        const tdSum = document.createElement("td");
        tdSum.className = "day-sum";
        tdSum.textContent = "‚Äì";
        tr.appendChild(tdSum);

        tbody.appendChild(tr);
      }
    }

    function clearDailyTable(clearInputs = true) {
      const tbody = document.getElementById("spendBody");
      const rows = tbody.querySelectorAll("tr");
      rows.forEach(row => {
        const sumCell = row.querySelector(".day-sum");
        if (sumCell) sumCell.textContent = "‚Äì";
        if (clearInputs) {
          const inputs = row.querySelectorAll("input[type='number']");
          inputs.forEach(input => (input.value = ""));
        }
      });
    }

    function calculateDailySpending() {
      const tbody = document.getElementById("spendBody");
      const rows = tbody.querySelectorAll("tr");
      let totalPesos = 0;

      rows.forEach(row => {
        const inputs = row.querySelectorAll("input[type='number']");
        let daySum = 0;
        inputs.forEach(input => {
          const v = Number(input.value) || 0;
          daySum += v;
        });
        totalPesos += daySum;

        const sumCell = row.querySelector(".day-sum");
        if (sumCell) {
          sumCell.textContent =
            daySum > 0
              ? daySum.toLocaleString("da-DK") + " ‚Ç±"
              : "‚Äì";
        }
      });

      const rate = Number(document.getElementById("rateDKK").value) || 0;

      let summary = "";
      if (totalPesos <= 0) {
        summary =
          "Udfyld nogle bel√∏b i tabellen og tryk p√• knappen for at se dit samlede forbrug.";
      } else {
        summary =
          "Samlet registreret forbrug: " +
          totalPesos.toLocaleString("da-DK") +
          " ‚Ç±";

        if (rate > 0) {
          const totalDKK = totalPesos / rate;
          const avgPesos = totalPesos / DAYS_TOTAL;
          const avgDKK = avgPesos / rate;

          summary +=
            " (ca. " +
            kr(totalDKK) +
            "). Gennemsnit pr. dag: " +
            avgPesos.toLocaleString("da-DK", {
              maximumFractionDigits: 0,
            }) +
            " ‚Ç± (ca. " +
            avgDKK.toLocaleString("da-DK", {
              maximumFractionDigits: 0,
            }) +
            " kr/dag).";
        } else {
          summary +=
            ". Indtast en valutakurs for at se bel√∏bet i kroner.";
        }
      }

      document.getElementById("dailySummary").textContent = summary;
      saveState();
    }

    // ---------- FUN FACTS ----------
    const funFacts = [
      "Filippinerne best√•r af mere end 7.600 √∏er.",
      "Landet har tre hoved√∏grupper: Luzon, Visayas og Mindanao.",
      "Filippinere taler mere end 170 forskellige sprog og dialekter.",
      "De officielle sprog er filipino (baseret p√• tagalog) og engelsk.",
      "Manila er hovedstaden, men Quezon City er den mest befolkede by.",
      "Filippinerne er kendt som verdens SMS-hovedstad ‚Äì folk sender rigtig mange beskeder.",
      "Jeepneys er et ikonisk transportmiddel lavet fra gamle amerikanske milit√¶rjeeps.",
      "Filippinerne ligger i en tyfon-zone og oplever mange tropiske storme hvert √•r.",
      "Landet ligger p√• Stillehavets Ildring og har flere aktive vulkaner.",
      "Mayon-vulkanen er kendt for sin n√¶sten perfekte kegleform.",
      "Filippinerne er et af verdens mest biodiversitetsrige lande.",
      "Tarsieren, et af verdens mindste primater, findes p√• Bohol.",
      "Whale sharks (butanding) kan ses bl.a. ved Donsol og Oslob.",
      "Filippinerne er verdens st√∏rste eksport√∏r af kokosn√∏dder.",
      "Mange filippinere arbejder i udlandet som OFW (Overseas Filipino Workers).",
      "Filippinere er kendt for st√¶rke familiev√¶rdier og store familiesammenkomster.",
      "Julefejringen starter ofte allerede i september og er en af verdens l√¶ngste.",
      "Lechon (helstegt gris) er en klassisk festret i Filippinerne.",
      "Adobo og sinigang er to af de mest kendte filippinske retter.",
      "Halo-halo er en popul√¶r dessert med is, frugt, b√∏nner og knust is.",
      "Filippinerne var en spansk koloni i mere end 300 √•r.",
      "Derfor har mange filippinere spanske efternavne som Santos, Reyes og Garcia.",
      "Katolicisme er den dominerende religion i Filippinerne.",
      "Filippinske fiestaer fejres n√¶sten overalt, ofte til √¶re for en lokal skytshelgen.",
      "Landet fik sit navn efter kong Filip II af Spanien.",
      "Filippinerne var ogs√• under amerikansk styre i starten af 1900-tallet.",
      "Basketball er en af de mest popul√¶re sportsgrene i Filippinerne.",
      "Karaoke (videoke) er mega stort, og mange har anl√¶g derhjemme.",
      "Filippinerne er kendt for dygtige sangere, b√•de lokalt og internationalt.",
      "Boracay er kendt for sine smukke hvide sandstrande.",
      "Palawan bliver ofte kaldt en af verdens smukkeste √∏er.",
      "Filippinerne producerer meget mango ‚Äì is√¶r fra Guimaras.",
      "Jollibee er en k√¶mpe fastfoodk√¶de og et nationalt ikon.",
      "Filippinere er kendt for at v√¶re g√¶stfrie og smilende.",
      "Mange filippinere er tosprogede eller flersprogede fra barnsben.",
      "Respekt for √¶ldre vises bl.a. ved at sige ‚Äúpo‚Äù og ‚Äúopo‚Äù.",
      "Traditionen ‚Äúmano po‚Äù er at tage en √¶ldres h√•nd til panden som respekt.",
      "Filippinerne har en ung befolkning ‚Äì gennemsnitsalderen er ret lav.",
      "Landet har en voksende tech- og BPO-industri (callcentre, support osv.).",
      "Chicarr√≥n, pandesal og lumpia er popul√¶re snacks.",
      "Mange filippinske byer har navne med spansk oprindelse.",
      "Filippinerne har flere UNESCO World Heritage Sites, fx Banaue-risterrasserne.",
      "Filippinsk tid (ofte kaldet ‚ÄúFilipino time‚Äù) er ber√∏mt for at v√¶re ret afslappet.",
      "Der er ofte karaoke i malls, p√• gaden og til private fester.",
      "Tricycles og pedicabs er almindelige lokale transportmidler.",
      "Filippinerne har en st√¶rk OFW-kultur, hvor penge sendes hjem til familien.",
      "Landet er en af verdens st√∏rste producenter af nikkel og andre mineraler.",
      "Mange filippinere elsker b√•de K-pop, amerikansk pop og lokal OPM-musik.",
      "Filippinske bryllupper og fester kan vare mange timer ‚Äì med masser af mad.",
      "Filippinsk h√∏flighed og varme g√∏r, at mange rejsende f√∏ler sig hurtigt hjemme."
    ];

    function showRandomFact() {
      const el = document.getElementById("funFactText");
      const idx = Math.floor(Math.random() * funFacts.length);
      el.textContent = funFacts[idx];
    }

    // ---------- INIT ----------
    document.addEventListener("DOMContentLoaded", () => {
      buildDailyTable();
      setProfileLabels();
      loadState();
      attachInputListeners();
      calculate();
      calculateDailySpending();
    });
  </script>
</body>
</html>
